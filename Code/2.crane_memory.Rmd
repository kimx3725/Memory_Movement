---
title: "2.crane_memory"
author: "Dennis Kim"
date: '2022-04-05'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load packages 
```{r packages, message =FALSE, warning = FALSE}
# data calling & wrangling 
library(here)
library(readr)
library(tidyr)
library(purrr)
library(dplyr)
library(forcats)

# movement analysis 
library(amt)
```

# Load Data
```{r data call}
# read summer data for id == 5C
c515 = read_rds(here("data","summer_trk15_5c.Rdata"))
c516 = read_rds(here("data","summer_trk16_5c.Rdata"))
c517 = read_rds(here("data","summer_trk17_5c.Rdata"))
c518 = read_rds(here("data","summer_trk18_5c.Rdata"))
c519 = read_rds(here("data","summer_trk19_5c.Rdata"))
c520 = read_rds(here("data","summer_trk20_5c.Rdata"))
```

# Prepare data for SSF fitting
```{r ssf prep}
# factorize the age year
c515$age_yr <- factor(c515$age_yr, levels = c("hatch-yr", "second-yr", "third-yr", "fourth-yr", "fifth-yr", "sixth-yr", "adult"))
c516$age_yr <- factor(c516$age_yr, levels = c("hatch-yr", "second-yr", "third-yr", "fourth-yr", "fifth-yr", "sixth-yr", "adult"))
c517$age_yr <- factor(c517$age_yr, levels = c("hatch-yr", "second-yr", "third-yr", "fourth-yr", "fifth-yr", "sixth-yr", "adult"))
c518$age_yr <- factor(c518$age_yr, levels = c("hatch-yr", "second-yr", "third-yr", "fourth-yr", "fifth-yr", "sixth-yr", "adult"))
c519$age_yr <- factor(c519$age_yr, levels = c("hatch-yr", "second-yr", "third-yr", "fourth-yr", "fifth-yr", "sixth-yr", "adult"))
c520$age_yr <- factor(c520$age_yr, levels = c("hatch-yr", "second-yr", "third-yr", "fourth-yr", "fifth-yr", "sixth-yr", "adult"))

# drop the levels that are not present in the data
c515$nlcd_category <- droplevels(as.factor(c515$nlcd_category))
c516$nlcd_category <- droplevels(as.factor(c516$nlcd_category))
c517$nlcd_category <- droplevels(as.factor(c517$nlcd_category))
c518$nlcd_category <- droplevels(as.factor(c518$nlcd_category))
c519$nlcd_category <- droplevels(as.factor(c519$nlcd_category))
c520$nlcd_category <- droplevels(as.factor(c520$nlcd_category))

# change the reference level 
c515$nlcd_category <- fct_relevel(c515$nlcd_category, "wetlands") # wetlands 
c516$nlcd_category <- fct_relevel(c516$nlcd_category, "wetlands") # wetlands 
c517$nlcd_category <- fct_relevel(c517$nlcd_category, "wetlands") # wetlands 
c518$nlcd_category <- fct_relevel(c518$nlcd_category, "wetlands") # wetlands 
c519$nlcd_category <- fct_relevel(c519$nlcd_category, "wetlands") # wetlands 
c520$nlcd_category <- fct_relevel(c520$nlcd_category, "wetlands") # wetlands 

c515$age_yr <- fct_relevel(c515$age_yr, "hatch-yr")
c516$age_yr <- fct_relevel(c516$age_yr, "hatch-yr")
c517$age_yr <- fct_relevel(c517$age_yr, "hatch-yr")
c518$age_yr <- fct_relevel(c518$age_yr, "hatch-yr")
c519$age_yr <- fct_relevel(c519$age_yr, "hatch-yr")
c520$age_yr <- fct_relevel(c520$age_yr, "hatch-yr")

# calculate log sl and cos ta 
c515$log_sl_ <- log(c515$sl_)
c516$log_sl_ <- log(c516$sl_)
c517$log_sl_ <- log(c517$sl_)
c518$log_sl_ <- log(c518$sl_)
c519$log_sl_ <- log(c519$sl_)
c520$log_sl_ <- log(c520$sl_)

c515$cos_ta_ <- cos(c515$ta_)
c516$cos_ta_ <- cos(c516$ta_)
c517$cos_ta_ <- cos(c517$ta_)
c518$cos_ta_ <- cos(c518$ta_)
c519$cos_ta_ <- cos(c519$ta_)
c520$cos_ta_ <- cos(c520$ta_)
```

# Fitting SSF

**[note]** 

* **occurrence()** returns a distribution of where the animal might have been during the sampling period (or some range of times).
* **Negative coefficients** suggest cranes do not prefer using past year's locations.  
* **Positive coefficients** suggest they like to revisit past locations.

## 2016
```{r fit16}
# MODEL16: year 2016
m16 <- fit_issf(case_ ~ nlcd_category + OD15 + log_sl_ + strata(step_id_), data = c516)

summary(m16)
```
**[Interpreation]**

* OD15: **positive coefficient: In 2016, the crane selects the locations where they were in last year 2015.**

## 2017
```{r fit17}
# MODEL17: year 2017
m17 <- fit_issf(case_ ~ nlcd_category + OD16 + log_sl_ + strata(step_id_), data = c517)

summary(m17)
```
**[Interpreation]**

* OD16: **negative coefficient: In 2017, the crane does not select the locations where they were in last year 2016.**

## 2018
```{r fit18}
# MODEL18: year 2018
m18 <- fit_issf(case_ ~ nlcd_category + OD17 + log_sl_ + strata(step_id_), data = c518)

summary(m18)
```
**[Interpreation]**

* OD17: **positive coefficient: in 2018, the crane selects the locations where they were in last year 2017.**

## 2019
```{r fit19}
# MODEL19: year 2019
m19 <- fit_issf(case_ ~ nlcd_category + OD18 + log_sl_ + strata(step_id_), data = c519)

summary(m19)
```
**[Interpreation]**

* OD18: **positive coefficient: In 2019, the crane selects the locations where they were in last year 2018.**

## 2020
```{r fit20}
# MODEL20: year 2020
m20 <- fit_issf(case_ ~ nlcd_category + OD19 + log_sl_ + strata(step_id_), data = c520)

summary(m20)
```
**[Interpreation]**

* OD19: **positive coefficient: In 2020, the crane selects the locations where they were in last year 2019.**

# Summary 

Overall, The crane 5C would like to select their hatched (2015) locations during their 2nd year (2016) when they were by themselves without any information about the landscape. During their 3rd year (2017), the crane started exploring possible habitats to select and did not select the previous year's location (2016). After getting information about the landscape, the crane continue to revisit the same locations throughout the years (2018, 2019, 2020).  

# Document Footer 
```{r session info}
sessionInfo()
```